# --- CONFIGURACIÓN ---
try { Set-PSReadLineOption -HistorySaveStyle SaveNothing -ErrorAction SilentlyContinue } catch {}
if ($host.Runspace.ApartmentState -ne "STA") {
    powershell -STA -ExecutionPolicy Bypass -WindowStyle Hidden -File $PSCommandPath
    exit
}

Add-Type -AssemblyName System.Windows.Forms, System.Drawing
$api = @"
using System;
using System.Runtime.InteropServices;
public class API {
    [DllImport("user32.dll")] public static extern short GetAsyncKeyState(int vKey);
    [DllImport("user32.dll")] public static extern void mouse_event(int dwFlags, int dx, int dy, int dwData, int dwExtraInfo);
    [DllImport("user32.dll")] public static extern bool ReleaseCapture();
    [DllImport("user32.dll")] public static extern IntPtr SendMessage(IntPtr hWnd, int Msg, int wParam, int lParam);
}
"@
Add-Type -TypeDefinition $api

# --- VARIABLES ---
$script:lLast = 0
$script:sw = [System.Diagnostics.Stopwatch]::StartNew()

# --- INTERFAZ ---
$f = New-Object System.Windows.Forms.Form
$f.Text = "HeraMC | Only Left"; $f.Size = "320,240"; $f.BackColor = "10,10,10"
$f.FormBorderStyle = 'None'; $f.StartPosition = 'CenterScreen'; $f.TopMost = $true
$f.Add_MouseDown({ [API]::ReleaseCapture(); [API]::SendMessage($f.Handle, 0xA1, 0x2, 0) })

$title = New-Object System.Windows.Forms.Label
$title.Text = "HERA CLICKER V9"; $title.ForeColor = "Cyan"; $title.Font = "Segoe UI,12,Bold"; $title.Location = "20,15"; $title.AutoSize=$true; $f.Controls.Add($title)

$close = New-Object System.Windows.Forms.Label
$close.Text = "×"; $close.Font = "Arial,20,Bold"; $close.ForeColor = "Gray"; $close.Location = "285,10"; $close.Cursor = "Hand"; $close.Add_Click({ $f.Close() }); $f.Controls.Add($close)

# Fila Única: Click Izquierdo
$label = New-Object System.Windows.Forms.Label
$label.Text = "COMBAT CPS (Mantén presionado)"; $label.ForeColor = "White"; $label.Location = "25,65"; $label.AutoSize=$true; $f.Controls.Add($label)

$inp = New-Object System.Windows.Forms.TextBox
$inp.Text = "16"; $inp.BackColor = "20,20,20"; $inp.ForeColor = "Cyan"; $inp.BorderStyle = "FixedSingle"; $inp.Size = "60,25"; $inp.Location = "25,90"; $inp.TextAlign = "Center"; $f.Controls.Add($inp)

$status = New-Object System.Windows.Forms.Label
$status.Text = "ESTADO: ESPERANDO CLIC"; $status.ForeColor = "DimGray"; $status.Font = "Segoe UI,8"; $status.Location = "25,140"; $status.Size = "270,20"; $f.Controls.Add($status)

$btnSD = New-Object System.Windows.Forms.Button
$btnSD.Text = "SELF DESTRUCT"; $btnSD.BackColor = "80,20,20"; $btnSD.ForeColor = "White"; $btnSD.FlatStyle = "Flat"; $btnSD.Location = "25,180"; $btnSD.Size = "270,35"
$btnSD.Add_Click({ $f.Close() }); $f.Controls.Add($btnSD)

# --- LÓGICA CORE (SÓLO IZQUIERDO Y POR PRESIÓN) ---
$timer = New-Object System.Windows.Forms.Timer; $timer.Interval = 1
$timer.Add_Tick({
    $now = $script:sw.ElapsedMilliseconds
    
    # Comprobar si el botón IZQUIERDO (1) está presionado físicamente
    if ([API]::GetAsyncKeyState(1) -band 0x8000) {
        
        # Validar CPS
        $currentCps = 16
        if (![double]::TryParse($inp.Text, [ref]$currentCps)) { $currentCps = 16 }
        if ($currentCps -le 0) { $currentCps = 1 }

        # Si ha pasado el tiempo necesario, hacer click
        if ($now - $script:lLast -ge (1000 / $currentCps)) {
            # Simulamos el click (Down y Up)
            [API]::mouse_event(0x0002, 0, 0, 0, 0)
            [API]::mouse_event(0x0004, 0, 0, 0, 0)
            $script:lLast = $now
            $status.Text = "ESTADO: CLICKING ($currentCps CPS)"
            $status.ForeColor = "Cyan"
        }
    } else {
        $status.Text = "ESTADO: ESPERANDO CLIC"
        $status.ForeColor = "DimGray"
    }
})

$timer.Start()
[System.Windows.Forms.Application]::Run($f)
